<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>모바일 Code 128 바코드 스캐너</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: sans-serif;
            background: #f9f9f9;
            text-align: center;
        }
        h2 {
            margin-top: 1.5rem;
        }
        video {
            width: 95vw;
            max-width: 400px;
            max-height: 40vh;
            border: 2px solid #4caf50;
            border-radius: 10px;
            background: #000;
        }
        #result {
            font-size: 1.3rem;
            margin-top: 1.5rem;
            color: #2196f3;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <h2>📱 바코드 스캔 (Code 128)</h2>
    <video id="video" muted autoplay playsinline></video>
    <div id="result">바코드를 카메라에 비춰주세요</div>

    <script type="module">
        import { BrowserMultiFormatReader, BarcodeFormat } from 'https://cdn.jsdelivr.net/npm/@zxing/browser@0.1.1/+esm';

        const codeReader = new BrowserMultiFormatReader();
        const videoElement = document.getElementById('video');
        const resultDiv = document.getElementById('result');

        codeReader.listVideoInputDevices().then(videoInputDevices => {
            // 후면 카메라 우선 선택
            let backCamera = videoInputDevices.find(device => device.label.toLowerCase().includes('back'));
            let selectedDeviceId = backCamera ? backCamera.deviceId : videoInputDevices[0].deviceId;

            codeReader.decodeFromVideoDevice(selectedDeviceId, videoElement, (result, err) => {
                if (result) {
                    resultDiv.textContent = `✅ 인식 결과: ${result.getText()}`;
                    codeReader.reset(); // 한 번만 인식 후 멈춤
                }
            }, { formats: [BarcodeFormat.CODE_128] });
        }).catch(err => {
            resultDiv.textContent = '카메라 접근 실패: ' + err;
        });
    </script>
</body>
</html>
