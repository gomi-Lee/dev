<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Code128 ë°”ì½”ë“œ ìŠ¤ìºë„ˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: sans-serif;
      padding: 1rem;
      text-align: center;
    }
    button {
      padding: 10px 20px;
      font-size: 1rem;
      margin-bottom: 1rem;
      cursor: pointer;
    }
    video {
      width: 100%;
      max-height: 320px;
      border: 1px solid #ccc;
      display: none;
    }
    #result {
      margin-top: 1rem;
      font-size: 1.2rem;
      color: green;
    }
    #error {
      color: red;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <h2>ğŸ“· Code128 ë°”ì½”ë“œ ìŠ¤ìºë„ˆ</h2>
  <button id="startBtn">â–¶ï¸ ë°”ì½”ë“œ ìŠ¤ìº” ì‹œì‘</button>
  <video id="video" muted playsinline></video>
  <div id="result">ğŸ“„ ìŠ¤ìº” ê²°ê³¼ ì—†ìŒ</div>
  <div id="error"></div>

  <script type="module">
    import { BrowserMultiFormatReader } from 'https://cdn.jsdelivr.net/npm/@zxing/browser@0.1.1/+esm';

    const codeReader = new BrowserMultiFormatReader();
    const videoElement = document.getElementById('video');
    const resultEl = document.getElementById('result');
    const errorEl = document.getElementById('error');
    const startBtn = document.getElementById('startBtn');

    startBtn.addEventListener('click', initCamera);

    async function initCamera() {
      startBtn.disabled = true;
      startBtn.textContent = "ì¹´ë©”ë¼ ì‹¤í–‰ ì¤‘...";
      try {
        const devices = await codeReader.listVideoInputDevices();

        const backCam = devices.find(d =>
          d.label.toLowerCase().includes('back')
        ) || devices[0];

        videoElement.style.display = "block";

        await codeReader.decodeFromVideoDevice(
          backCam.deviceId,
          videoElement,
          (result, err) => {
            if (result) {
              resultEl.textContent = `âœ… ë°”ì½”ë“œ: ${result.getText()}`;
              codeReader.reset();
              startBtn.disabled = false;
              startBtn.textContent = "â–¶ï¸ ë‹¤ì‹œ ìŠ¤ìº”";
              videoElement.style.display = "none";
            }
          }
        );
      } catch (e) {
        errorEl.textContent = 'âŒ ì¹´ë©”ë¼ ì ‘ê·¼ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê¶Œí•œì„ í—ˆìš©í–ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.';
        console.error(e);
        startBtn.disabled = false;
        startBtn.textContent = "â–¶ï¸ ë°”ì½”ë“œ ìŠ¤ìº” ì‹œì‘";
      }
    }
  </script>
</body>
</html>
